# CVE-2025-47981 – Microsoft SPNEGO Extended Negotiation (NEGOEX) RCE Vulnerability

## Overview

* **QID:** 92287
* **CVE:** 2025-47981
* **Type:** Remote Code Execution (RCE)
* **Affected Component:** Microsoft SPNEGO Extended Negotiation (NEGOEX)

The vulnerability exists in the **SPNEGO Extended Negotiation Security Mechanism (NEGOEX)**, an extension of SPNEGO defined in \[RFC4178].
An **unauthenticated attacker** could exploit this issue by sending a **maliciously crafted message** to a vulnerable system, leading to **remote code execution**.

This issue impacts **Windows 10 (1607) and later**, including Windows 11, due to the default configuration of the following setting:

* `Network security: Allow PKU2U authentication requests to this computer to use online identities`

---

## Exploitation Path

* Attacker sends a malicious SPNEGO/NEGOEX message to a target machine.
* The system processes the request under **PKU2U authentication** (enabled by default).
* Exploitation may result in remote code execution with system-level privileges.

---

## Patches & Mitigations

### Patch

* Microsoft released security updates on **2025-07-08** addressing this vulnerability.
* Apply the latest cumulative updates for affected Windows versions.

### Mitigation Guidance

* Apply Microsoft patches immediately, prioritizing **internet-facing** and **critical systems**.
* Consider **network segmentation** to reduce attack surface.
* Monitor network traffic for abnormal `SPNEGO/NEGOEX` negotiation attempts.
* Temporarily **disable PKU2U authentication** if not required.
* Deploy **NIDS/NIPS** solutions to detect exploitation attempts.

---

## Intune Mitigation Policy

* **Policy Name:** Disable PKU2U
* **Description:** Disables PKU2U authentication to mitigate CVE-2025-47981 and harden endpoint security.
* **Path:** Local Policies → Security Options → Network Security: Allow PKU2U Authentication Requests → `Block`

### Registry Change

```reg
HKLM:\System\CurrentControlSet\Control\Lsa\pku2u
AllowOnlineID = DWORD 0
```

---

## Risks & Considerations

* Disabling PKU2U may affect **RDP scenarios where servers authenticate into Entra-only clients using online IDs**.
* For most workstation/laptop deployments, the risk is minimal (servers typically do not RDP into endpoints).

---

## References

* [Microsoft Security Advisory – CVE-2025-47981](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-47981)
* [Feedly CVE Summary](https://feedly.com/cve/CVE-2025-47981)
* [Microsoft Documentation – PKU2U Authentication Policy](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/security-policy-settings/network-security-allow-pku2u-authentication-requests-to-this-computer-to-use-online-identities)
* [CIS Benchmark – Windows Server 2019 STIG](https://www.tenable.com/audits/items/CIS_Microsoft_Windows_Server_2019_STIG_v3.0.0_STIG_MS.audit:49ca4f3b88956870a456ca883b48dc58)
* [Syxsense – PKU2U Hardening Guidance](https://www.syxsense.com/syxsense-securityarticles/cis_benchmarks/syx-1033-12319.html)

